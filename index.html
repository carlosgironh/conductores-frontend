<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Registro Conductores</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h2>Registro</h2>
<form id="formRegistro">
<input type="email" id="email" placeholder="Correo" required>
<input type="password" id="password" placeholder="Password" required minlength="6">
<button type="submit">Registrar</button>
</form>

<h2>Login</h2>
<form id="formLogin">
<input type="email" id="loginEmail" required>
<input type="password" id="loginPassword" required>
<button type="submit">Login</button>
</form>

<h2>Subir Documento</h2>
<input type="file" id="archivo" accept=".pdf,.jpg,.jpeg">
<button onclick="subir()">Subir</button>

<script>

let token = null;
let conductorId = null;

// REGISTRO
document.getElementById("formRegistro").addEventListener("submit", async e => {
  e.preventDefault();

  const res = await fetch("/api/registro", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      email: email.value,
      password: password.value
    })
  });

  const data = await res.json();
  conductorId = data.conductorId;
  alert(data.mensaje);
});

// LOGIN
document.getElementById("formLogin").addEventListener("submit", async e => {
  e.preventDefault();

  const res = await fetch("/api/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      email: loginEmail.value,
      password: loginPassword.value
    })
  });

  const data = await res.json();
  token = data.token;
  alert("Login exitoso");
});

// SUBIDA
async function subir() {

  const file = document.getElementById("archivo").files[0];

  if (!file) {
    alert("Selecciona archivo");
    return;
  }

  const formData = new FormData();
  formData.append("archivo", file);

  const res = await fetch(`/api/documentos/${conductorId}/cedula`, {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${token}`
    },
    body: formData
  });

  const data = await res.json();
  alert(data.mensaje || data.error);
}

</script>
</body>
</html>