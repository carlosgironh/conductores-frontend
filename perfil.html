<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Perfil del Conductor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
body{
  font-family: Arial;
  background:#f4f6f8;
  padding:20px;
}

.card{
  max-width:900px;
  margin:auto;
  background:white;
  padding:25px;
  border-radius:12px;
  box-shadow:0 5px 20px rgba(0,0,0,0.1);
}

.section{
  margin-top:20px;
  padding:15px;
  background:#f9fafc;
  border-radius:8px;
}

.line{
  margin-bottom:6px;
}

button{
  margin-top:10px;
  padding:6px 12px;
  border:none;
  background:#0d6efd;
  color:white;
  border-radius:6px;
  cursor:pointer;
}
</style>
</head>
<body>

<div class="card">
<h2>Perfil del Conductor</h2>

<div id="contenido"></div>

<div style="text-align:center;margin-top:25px;">
<canvas id="qr"></canvas><br>
<button onclick="descargarQR()">Descargar QR</button>
</div>

</div>

<script>

const API = "https://conductores-api.onrender.com";
const conductorId = new URLSearchParams(window.location.search).get("id");

async function cargar(){

  if(!conductorId){
    alert("ID no especificado");
    return;
  }

  const res = await fetch(`${API}/api/conductores/${conductorId}`);
  const data = await res.json();

  if(!res.ok){
    alert("Conductor no encontrado");
    return;
  }

  const c = data.conductor;

  document.getElementById("contenido").innerHTML = `
    <div class="section">
      <div class="line"><strong>Nombre:</strong> ${c.nombres} ${c.apellidos}</div>
      <div class="line"><strong>Cédula:</strong> ${c.cedula}</div>
      <div class="line"><strong>Licencia:</strong> ${c.licencia}</div>
    </div>

    <div class="section">
      <div class="line"><strong>Vehículo:</strong> ${c.marca} ${c.modelo}</div>
      <div class="line"><strong>Placa:</strong> ${c.placa}</div>
      <div class="line"><strong>Color:</strong> ${c.color}</div>
    </div>

    <div class="section">
      <div class="line"><strong>Póliza:</strong> ${c.poliza_numero}</div>
    </div>
  `;

  generarQR();

}

function generarQR(){
  const urlPublica = window.location.href;

  QRCode.toCanvas(document.getElementById("qr"), urlPublica,{
    width:220,
    errorCorrectionLevel:'H'
  });
}

function descargarQR(){
  const canvas = document.getElementById("qr");
  const link = document.createElement("a");
  link.download = "perfil_qr.png";
  link.href = canvas.toDataURL();
  link.click();
}

cargar();

</script>

</body>
</html>